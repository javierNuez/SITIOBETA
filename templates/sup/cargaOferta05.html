{% include 'sup/cabecera.html' %}
<form action="/sup/pedidos/template" method="post" enctype="multipart/form-data">
    <input type="text" id="hashUsuarioO" name="hashUsuario" hidden>
    <script>
        var hashUsuario = sessionStorage.getItem("hash");
        document.getElementById("hashUsuarioO").value = hashUsuario;

        if (!(hashUsuario)) {
            window.location.href = "/";
        }

    </script>
    {% with messages= get_flashed_messages() %}

    {% if messages %}
    <div class="alert alert-warning alert-dismissible fade show" role="alert">
        <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
        <strong>¡Cuidado!</strong> {% for message in messages %}{{ message }}{% endfor %}
    </div>
    {% endif %}
    {% endwith %}

    <div class="card-body">

        <div class="card border-info">
            <div class="card-header">
                <h4>Informacion del pedido:</h4>
                <h6>Usuario: {% if usuario %} {{usuario[-5:]}} {% endif %}</h6>
                <h6>Código droguería: {% if drogueria %} {{drogueria}} {% endif %}</h6>
                <h6>Código cliente: {% if cliente %} {{cliente}} {% endif %}</h6>
                {% if usuario %}
                <input type="text" name="pedidoUsuario" value="{{usuario[-5:]}}" hidden>
                {% endif %}
                {% if drogueria %}
                <input type="text" name="pedidoDrogueria" value="{{drogueria}}" hidden>
                {% endif %}
                {% if cliente %}
                <input type="text" name="pedidoCliente" value="{{cliente}}" hidden>
                {% endif %}
            </div>
            {% if salidas %}
            <input type="text" name="pedidoOferta" value="{{salidas}}" hidden>
            {% endif %}
            {% for salida in salidas %}

            <div class="card-body" style="padding: 16px 0px ;">


                <table id="tblContact" class="table table-sm table-hover table-bordered">
                    <thead>
                        <tr>
                            <th style="text-align: left;" scope="col" class="table-primary">{{salida[1][0][2]}}</th>
                            <th style="text-align: left;" scope="col" class="table-primary"></th>
                            <th style="text-align: left;" scope="col" class="table-primary"></th>
                            <th style="text-align: left;" scope="col" class="table-primary"></th>
                            <th style="text-align: left;" scope="col" class="table-primary">Can. mínima
                                {{salida[1][0][7]}}</th>
                        </tr>
                    </thead>
                    <tbody id="">
                        <!--<table id="tblContact" class="table table-sm">-->
                        <thead>
                            <tr>
                                <th style="text-align: center;" scope="col" class="table-info">
                                    Producto</th>
                                <th style="text-align: center;" scope="col" class="table-info">
                                    Código</th>
                                <th style="text-align: center;" scope="col" class="table-info">
                                    Cantidad mínima</th>
                                <th style="text-align: center;" scope="col" class="table-info">
                                    Descuento</th>
                                <th style="text-align: center;" scope="col" class="table-info">
                                    Unidades</th>
                            </tr>
                        </thead>
                    <tbody id="">

                        {% for i in salida[1] %}

                        <tr>
                            <td style="text-align: center;" scope="col" class="table-light">
                                {{i[10]}}
                            </td>
                            <td style="text-align: center;" scope="col" class="table-light">
                                {{i[9]}}
                            </td>
                            <td style="text-align: center;" scope="col" class="table-light" id="min{{i[0]}}"
                                value="{{i[13]}}">
                                {{i[13]}}
                            </td>
                            <td style="text-align: center;" scope="col" class="table-light">
                                {{i[14]}}%
                            </td>
                            <td style="text-align: center;" scope="col" class="table-light">

                                <input class="inputs" type="number" style="width:40px;text-align: center;" id="{{i[0]}}"
                                    min="{{i[13]}}" oninput="sumarDocumento(this.value, {{i[1]}})" value="0">
                                <!--min="{{i[13]}}" -->
                            </td>
                        </tr>
                        {% endfor %}
                        <tr>
                            <td style="text-align: center;" scope="col" class="table-secondary">

                            </td>
                            <td style="text-align: center;" scope="col" class="table-secondary">

                            </td>
                            <td style="text-align: center;" scope="col" class="table-secondary">

                            </td>
                            <td style="text-align: center;" scope="col" class="table-secondary">

                            </td>
                            <td style="text-align: center;" scope="col" class="table-secondary">Total:
                                <input type="number" min="{{salida[1][0][7]}}" style="width:60px; text-align: center;"
                                    id="{{salida[1][0][1]}}" value="0" onchange="processChange({{salida[1][0][1]}})"
                                    disabled>

                            </td>
                        </tr>
                    </tbody>
                </table>
            </div>
            {% endfor %}
            <div class="card-footer text-muted">
                <div class="card-footer text-muted" align="center">
                    <button class="btn btn-success btn-md" type="submit" id="enviarBoton" style="margin:auto ;"
                        onclick="sacarMinimo()">Enviar
                        pedido</button>
                </div>
            </div>
        </div>
        {% if anchoModulos %}
        <input type="text" id="anchoModulos" value="{{anchoModulos}}" hidden>
        {% endif %}
        {% if listaInput %}
        <input type="text" id="listaInput" value="{{listaInput}}" hidden>
        {% endif %}

        <script>
            function processChange(ide) {
                document.getElementById(ide).value = 0;
            }
            function sacarMinimo() {

                let anchoModulos0 = document.getElementById('anchoModulos').value;
                let listaInput0 = document.getElementById('listaInput').value;
                let listaInputArr0 = JSON.parse(listaInput0);
                for (let i = 0; i < anchoModulos0; i++) {
                    let arr0 = listaInputArr0[i].split(':');

                    let listaArr0 = JSON.parse(arr0[1]); /*la lista de elementos input del modulo*/
                    let listaArr00 = JSON.parse(arr0[0]);
                    console.log(listaArr00);
                    document.getElementById(listaArr00).disabled = false;
                    let n00 = document.getElementById(listaArr00).value;
                    n00 = parseInt(n00);
                    invalido = document.getElementsByTagName("input").value;
                    console.log("1" + invalido);
                    if (n00 == 0) {

                        document.getElementById(listaArr00).setAttribute("min", "");
                    }
                    invalido = document.getElementsByTagName("input").invalid;
                    console.log("2" + invalido);


                    for (let i = 0; i < listaArr0.length; i++) {
                        let n0 = document.getElementById(listaArr0[i]).value;
                        n0 = parseInt(n0);
                        if (n0 == 0) {
                            document.getElementById(listaArr0[i]).setAttribute("min", "");
                        }

                    }
                }
            }

            function sumarDocumento(valor, modulo) {
                let anchoModulos = document.getElementById('anchoModulos').value;
                let listaInput = document.getElementById('listaInput').value;
                let listaInputArr = JSON.parse(listaInput);

                for (let i = 0; i < anchoModulos; i++) {
                    let arr = listaInputArr[i].split(':');
                    if (arr[0] == modulo) {
                        let listaArr = JSON.parse(arr[1]); /*la lista de elementos input del modulo*/
                        suma = 0;
                        for (let i = 0; i < listaArr.length; i++) {
                            let n = document.getElementById(listaArr[i]).value;
                            n = parseInt(n);
                            suma += n;
                        }
                        document.getElementById(arr[0]).value = suma;
                    }
                }
            }
        </script>
    </div>
</form>
{% include 'sup/pie.html' %}